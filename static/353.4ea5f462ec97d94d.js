"use strict";(self.webpackChunkathar_cosmetics=self.webpackChunkathar_cosmetics||[]).push([[353],{7353:(k,g,d)=>{d.r(g),d.d(g,{ProductFormComponent:()=>M});var l=d(177),s=d(4341),u=d(1069),p=d(1785),e=d(4438),f=d(6241),_=d(7473);function h(a,m){if(1&a&&(e.j41(0,"option",31),e.EFF(1),e.k0s()),2&a){const r=m.$implicit;e.Y8G("value",r.id),e.R7$(),e.JRh(r.name)}}function F(a,m){if(1&a){const r=e.RV6();e.j41(0,"div",34)(1,"div",35),e.nrm(2,"img",36),e.j41(3,"button",37),e.bIt("click",function(){const t=e.eBV(r).index,n=e.XpG(2);return e.Njj(n.removeImage(t))}),e.EFF(4," \xd7 "),e.k0s()(),e.j41(5,"p",38),e.EFF(6),e.k0s(),e.j41(7,"p",39),e.EFF(8),e.k0s()()}if(2&a){const r=m.$implicit,o=e.XpG(2);e.R7$(2),e.Y8G("src",r.preview,e.B4B)("alt",r.file.name),e.R7$(4),e.JRh(r.file.name),e.R7$(2),e.JRh(o.formatFileSize(r.file.size))}}function v(a,m){if(1&a&&(e.j41(0,"div",32),e.DNE(1,F,9,4,"div",33),e.k0s()),2&a){const r=e.XpG();e.R7$(),e.Y8G("ngForOf",r.productFormImages)}}function b(a,m){if(1&a){const r=e.RV6();e.j41(0,"div",43),e.nrm(1,"img",36),e.j41(2,"button",44),e.bIt("click",function(){const t=e.eBV(r).$implicit,n=e.XpG(2);return e.Njj(n.deleteExistingImage(t.id))}),e.EFF(3," Delete "),e.k0s()()}if(2&a){const r=m.$implicit,o=e.XpG(2);e.R7$(),e.Y8G("src",o.getImageUrl(r.url),e.B4B)("alt",r.alt_text||"Product image")}}function P(a,m){if(1&a&&(e.j41(0,"div",40)(1,"h3"),e.EFF(2,"Current Images"),e.k0s(),e.j41(3,"div",41),e.DNE(4,b,4,2,"div",42),e.k0s()()),2&a){const r=e.XpG();e.R7$(4),e.Y8G("ngForOf",r.existingImages)}}function C(a,m){if(1&a){const r=e.RV6();e.j41(0,"app-confirm-modal",45),e.bIt("confirm",function(){e.eBV(r);const t=e.XpG();return e.Njj(t.confirmDeleteImage())})("cancel",function(){e.eBV(r);const t=e.XpG();return t.showDeleteConfirm=!1,e.Njj(t.imageToDelete=null)}),e.k0s()}2&a&&e.Y8G("danger",!0)}let M=(()=>{class a{constructor(r,o,t,n){this.route=r,this.router=o,this.productService=t,this.notificationService=n,this.isEditMode=!1,this.productId=null,this.categories=[],this.saving=!1,this.productForm={name_en:"",name_ar:"",description_en:"",description_ar:"",price:0,stock:0,sku:"",category_id:null,is_featured:!1},this.productFormImages=[],this.existingImages=[],this.showDeleteConfirm=!1,this.imageToDelete=null}ngOnInit(){this.loadCategories(),this.route.params.subscribe(r=>{r.id&&(this.isEditMode=!0,this.productId=+r.id,this.loadProduct(this.productId))})}loadCategories(){this.productService.getCategories().subscribe({next:r=>{r.success&&(this.categories=r.data)}})}loadProduct(r){this.productService.getProduct(r).subscribe({next:o=>{if(o.success&&o.data){const t=o.data;this.productForm={name_en:t.name_en,name_ar:t.name_ar||t.name_en,description_en:t.description_en||"",description_ar:t.description_ar||t.description_en||"",price:t.price,stock:t.stock,sku:t.sku,category_id:t.category_id,is_featured:t.is_featured},this.existingImages=t.images||[]}},error:()=>{this.notificationService.error("Error","Failed to load product"),this.goBack()}})}onImageSelected(r){const o=r.target;o.files&&o.files.length>0&&Array.from(o.files).forEach(t=>{if(t.size>10485760)return void this.notificationService.warning("File Too Large",`${t.name} is larger than 10MB`);const n=new FileReader;n.onload=c=>{this.productFormImages.push({file:t,preview:c.target?.result})},n.readAsDataURL(t)})}removeImage(r){this.productFormImages.splice(r,1)}deleteExistingImage(r){this.imageToDelete=r,this.showDeleteConfirm=!0}confirmDeleteImage(){!this.imageToDelete||!this.productId||this.productService.deleteProductImage(this.productId,this.imageToDelete).subscribe({next:r=>{r.success?(this.notificationService.success("Success","Image deleted successfully"),this.existingImages=this.existingImages.filter(o=>o.id!==this.imageToDelete),this.showDeleteConfirm=!1,this.imageToDelete=null):this.notificationService.error("Error","Failed to delete image")},error:r=>{this.notificationService.error("Error",r.error?.message||"Failed to delete image")}})}formatFileSize(r){if(0===r)return"0 Bytes";const n=Math.floor(Math.log(r)/Math.log(1024));return Math.round(r/Math.pow(1024,n)*100)/100+" "+["Bytes","KB","MB"][n]}getImageUrl(r){return r?r.startsWith("http://")||r.startsWith("https://")||r.startsWith("/")?r:`/${r}`:""}saveProduct(){if(!this.productForm.name_en||!this.productForm.sku||!this.productForm.category_id)return void this.notificationService.error("Validation Error","Please fill in all required fields");this.saving=!0;const r={...this.productForm,name_ar:this.productForm.name_ar||this.productForm.name_en,description_ar:this.productForm.description_ar||this.productForm.description_en||"",category_id:Number(this.productForm.category_id),price:Number(this.productForm.price),stock:Number(this.productForm.stock)||0};this.isEditMode&&this.productId?this.productService.updateProduct(this.productId,r).subscribe({next:o=>{o.success?this.productFormImages.length>0?this.uploadProductImages(this.productId):(this.saving=!1,this.notificationService.success("Success","Product updated successfully"),this.goBack()):(this.saving=!1,this.notificationService.error("Error",o.message||"Failed to update product"))},error:o=>{this.saving=!1,this.notificationService.error("Error",o.error?.message||"Failed to update product")}}):this.productService.createProduct(r).subscribe({next:o=>{if(o.success&&o.data)this.productFormImages.length>0?this.uploadProductImages(o.data.id):(this.saving=!1,this.notificationService.success("Success","Product created successfully"),this.goBack());else{this.saving=!1;const t=o.message||o.errors?.join(", ")||"Failed to create product";this.notificationService.error("Error",t)}},error:o=>{this.saving=!1;let t="Failed to create product";o.error&&(o.error.errors&&Array.isArray(o.error.errors)?t=o.error.errors.join(", "):o.error.message&&(t=o.error.message)),this.notificationService.error("Error",t)}})}uploadProductImages(r){if(0===this.productFormImages.length)return this.saving=!1,void this.goBack();let o=0;const t=this.productFormImages.length;let n=!1;this.productFormImages.forEach((c,i)=>{this.productService.uploadProductImage(r,c.file).subscribe({next:()=>{o++,o===t&&(this.saving=!1,n?this.notificationService.warning("Partial Success","Product saved but some images failed to upload"):this.notificationService.success("Success",this.isEditMode?"Product updated successfully":"Product created successfully"),this.goBack())},error:x=>{n=!0,o++,o===t&&(this.saving=!1,this.notificationService.warning("Partial Success","Product saved but some images failed to upload"),this.goBack())}})})}goBack(){this.router.navigate(["/admin"])}static{this.\u0275fac=function(o){return new(o||a)(e.rXU(u.nX),e.rXU(u.Ix),e.rXU(f.b),e.rXU(_.J))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-product-form"]],standalone:!0,features:[e.aNF],decls:87,vars:14,consts:[["imageInput",""],[1,"product-form-page"],[1,"container"],[1,"form-header"],[1,"back-btn",3,"click"],[1,"product-form","card",3,"ngSubmit"],[1,"form-section"],[1,"section-title"],[1,"form-group"],[1,"required"],["type","text","name","name_en","required","","placeholder","Enter product name",1,"form-input",3,"ngModelChange","ngModel"],["type","text","name","sku","required","","placeholder","e.g., PROD-001",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-grid"],["name","category_id","required","",1,"form-select",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","checkbox","name","is_featured",1,"checkbox-input",3,"ngModelChange","ngModel"],["type","number","step","0.01","min","0","name","price","required","","placeholder","0.00",1,"form-input",3,"ngModelChange","ngModel"],["type","number","min","0","name","stock","required","","placeholder","0",1,"form-input",3,"ngModelChange","ngModel"],["name","description_en","rows","4","placeholder","Enter product description",1,"form-textarea",3,"ngModelChange","ngModel"],[1,"image-upload-area"],["type","file","accept","image/*","multiple","","id","image-upload",1,"file-input",3,"change"],["for","image-upload",1,"upload-label"],[1,"upload-icon"],[1,"upload-text"],["class","selected-images-grid",4,"ngIf"],["class","existing-images-section",4,"ngIf"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],["title","Delete Image","message","Are you sure you want to delete this image? This action cannot be undone.","confirmText","Delete","cancelText","Cancel",3,"danger","confirm","cancel",4,"ngIf"],[3,"value"],[1,"selected-images-grid"],["class","image-preview-card",4,"ngFor","ngForOf"],[1,"image-preview-card"],[1,"image-wrapper"],[3,"src","alt"],["type","button","title","Remove image",1,"remove-image-btn",3,"click"],[1,"image-name"],[1,"image-size"],[1,"existing-images-section"],[1,"existing-images-grid"],["class","existing-image-card",4,"ngFor","ngForOf"],[1,"existing-image-card"],["type","button","title","Delete image",1,"delete-image-btn",3,"click"],["title","Delete Image","message","Are you sure you want to delete this image? This action cannot be undone.","confirmText","Delete","cancelText","Cancel",3,"confirm","cancel","danger"]],template:function(o,t){if(1&o){const n=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),e.bIt("click",function(){return e.eBV(n),e.Njj(t.goBack())}),e.j41(4,"span"),e.EFF(5,"\u2190"),e.k0s(),e.EFF(6," Back to Products "),e.k0s(),e.j41(7,"h1"),e.EFF(8),e.k0s()(),e.j41(9,"form",5),e.bIt("ngSubmit",function(){return e.eBV(n),e.Njj(t.saveProduct())}),e.j41(10,"section",6)(11,"h2",7),e.EFF(12,"Basic Information"),e.k0s(),e.j41(13,"div",8)(14,"label"),e.EFF(15,"Product Name "),e.j41(16,"span",9),e.EFF(17,"*"),e.k0s()(),e.j41(18,"input",10),e.mxI("ngModelChange",function(i){return e.eBV(n),e.DH7(t.productForm.name_en,i)||(t.productForm.name_en=i),e.Njj(i)}),e.k0s()(),e.j41(19,"div",8)(20,"label"),e.EFF(21,"SKU "),e.j41(22,"span",9),e.EFF(23,"*"),e.k0s()(),e.j41(24,"input",11),e.mxI("ngModelChange",function(i){return e.eBV(n),e.DH7(t.productForm.sku,i)||(t.productForm.sku=i),e.Njj(i)}),e.k0s()(),e.j41(25,"div",12)(26,"div",8)(27,"label"),e.EFF(28,"Category "),e.j41(29,"span",9),e.EFF(30,"*"),e.k0s()(),e.j41(31,"select",13),e.mxI("ngModelChange",function(i){return e.eBV(n),e.DH7(t.productForm.category_id,i)||(t.productForm.category_id=i),e.Njj(i)}),e.j41(32,"option",14),e.EFF(33,"Select a category"),e.k0s(),e.DNE(34,h,2,2,"option",15),e.k0s()(),e.j41(35,"div",8)(36,"label")(37,"input",16),e.mxI("ngModelChange",function(i){return e.eBV(n),e.DH7(t.productForm.is_featured,i)||(t.productForm.is_featured=i),e.Njj(i)}),e.k0s(),e.j41(38,"span"),e.EFF(39,"Featured Product"),e.k0s()()()()(),e.j41(40,"section",6)(41,"h2",7),e.EFF(42,"Pricing & Inventory"),e.k0s(),e.j41(43,"div",12)(44,"div",8)(45,"label"),e.EFF(46,"Price ($) "),e.j41(47,"span",9),e.EFF(48,"*"),e.k0s()(),e.j41(49,"input",17),e.mxI("ngModelChange",function(i){return e.eBV(n),e.DH7(t.productForm.price,i)||(t.productForm.price=i),e.Njj(i)}),e.k0s()(),e.j41(50,"div",8)(51,"label"),e.EFF(52,"Stock Quantity "),e.j41(53,"span",9),e.EFF(54,"*"),e.k0s()(),e.j41(55,"input",18),e.mxI("ngModelChange",function(i){return e.eBV(n),e.DH7(t.productForm.stock,i)||(t.productForm.stock=i),e.Njj(i)}),e.k0s()()()(),e.j41(56,"section",6)(57,"h2",7),e.EFF(58,"Description"),e.k0s(),e.j41(59,"div",8)(60,"label"),e.EFF(61,"Product Description"),e.k0s(),e.j41(62,"textarea",19),e.mxI("ngModelChange",function(i){return e.eBV(n),e.DH7(t.productForm.description_en,i)||(t.productForm.description_en=i),e.Njj(i)}),e.k0s()()(),e.j41(63,"section",6)(64,"h2",7),e.EFF(65,"Product Images"),e.k0s(),e.j41(66,"div",20)(67,"input",21,0),e.bIt("change",function(i){return e.eBV(n),e.Njj(t.onImageSelected(i))}),e.k0s(),e.j41(69,"label",22)(70,"div",23),e.EFF(71,"\u{1f4f7}"),e.k0s(),e.j41(72,"div",24)(73,"strong"),e.EFF(74,"Click to upload images"),e.k0s(),e.j41(75,"span"),e.EFF(76,"or drag and drop"),e.k0s(),e.j41(77,"small"),e.EFF(78,"PNG, JPG, GIF up to 10MB each"),e.k0s()()()(),e.DNE(79,v,2,1,"div",25)(80,P,5,1,"div",26),e.k0s(),e.j41(81,"div",27)(82,"button",28),e.bIt("click",function(){return e.eBV(n),e.Njj(t.goBack())}),e.EFF(83,"Cancel"),e.k0s(),e.j41(84,"button",29),e.EFF(85),e.k0s()()()(),e.DNE(86,C,1,1,"app-confirm-modal",30),e.k0s()}2&o&&(e.R7$(8),e.JRh(t.isEditMode?"Edit Product":"Add New Product"),e.R7$(10),e.R50("ngModel",t.productForm.name_en),e.R7$(6),e.R50("ngModel",t.productForm.sku),e.R7$(7),e.R50("ngModel",t.productForm.category_id),e.R7$(3),e.Y8G("ngForOf",t.categories),e.R7$(3),e.R50("ngModel",t.productForm.is_featured),e.R7$(12),e.R50("ngModel",t.productForm.price),e.R7$(6),e.R50("ngModel",t.productForm.stock),e.R7$(7),e.R50("ngModel",t.productForm.description_en),e.R7$(17),e.Y8G("ngIf",t.productFormImages.length>0),e.R7$(),e.Y8G("ngIf",t.isEditMode&&t.existingImages.length>0),e.R7$(4),e.Y8G("disabled",t.saving),e.R7$(),e.SpI(" ",t.saving?"Saving...":t.isEditMode?"Update Product":"Create Product"," "),e.R7$(),e.Y8G("ngIf",t.showDeleteConfirm))},dependencies:[l.MD,l.Sq,l.bT,s.YN,s.qT,s.xH,s.y7,s.me,s.Q0,s.Zm,s.wz,s.BC,s.cb,s.YS,s.VZ,s.vS,s.cV,u.iI,p.B],styles:[".product-form-page[_ngcontent-%COMP%]{padding:2rem 0;min-height:calc(100vh - 200px)}.form-header[_ngcontent-%COMP%]{margin-bottom:2rem;h1{margin:1rem 0 0;color:var(--text-primary)}}.back-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;background:transparent;border:1px solid var(--neutral-medium);color:var(--text-secondary);padding:.75rem 1.5rem;border-radius:var(--border-radius-small);cursor:pointer;font-size:.95rem;transition:all .2s ease;margin-bottom:1rem;&:hover{background:var(--bg-secondary);color:var(--text-primary);border-color:var(--primary)}span{font-size:1.2rem}}.product-form[_ngcontent-%COMP%]{padding:2.5rem;max-width:1000px;margin:0 auto}.form-section[_ngcontent-%COMP%]{margin-bottom:3rem;padding-bottom:2rem;border-bottom:1px solid var(--neutral-medium);&:last-of-type{border-bottom:none}}.section-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--primary);margin-bottom:1.5rem;padding-bottom:.75rem;border-bottom:2px solid var(--primary)}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem;label{display:block;margin-bottom:.5rem;font-weight:500;color:var(--text-primary);font-size:.95rem}.required{color:var(--error)}}.form-input[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%], .form-textarea[_ngcontent-%COMP%]{width:100%;padding:.875rem 1rem;border:2px solid var(--neutral-medium);border-radius:var(--border-radius-small);font-size:.95rem;font-family:Roboto,sans-serif;transition:all .2s ease;background:#fff;&:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px #2c5f5f1a}&::placeholder{color:var(--text-muted)}}.form-textarea[_ngcontent-%COMP%]{resize:vertical;min-height:100px}.checkbox-input[_ngcontent-%COMP%]{margin-right:.5rem;width:18px;height:18px;cursor:pointer}.image-upload-area[_ngcontent-%COMP%]{border:2px dashed var(--neutral-medium);border-radius:var(--border-radius);padding:3rem 2rem;text-align:center;transition:all .3s ease;margin-bottom:2rem;background:var(--bg-secondary);&:hover{border-color:var(--primary);background:#2c5f5f05}}.file-input[_ngcontent-%COMP%]{display:none}.upload-label[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;cursor:pointer}.upload-icon[_ngcontent-%COMP%]{font-size:3rem}.upload-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;strong{color:var(--text-primary);font-size:1.1rem}span{color:var(--text-secondary);font-size:.9rem}small{color:var(--text-muted);font-size:.85rem}}.selected-images-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:1.5rem;margin-top:2rem}.image-preview-card[_ngcontent-%COMP%]{border:1px solid var(--neutral-medium);border-radius:var(--border-radius-small);overflow:hidden;background:#fff;transition:transform .2s ease,box-shadow .2s ease;&:hover{transform:translateY(-4px);box-shadow:var(--shadow)}}.image-wrapper[_ngcontent-%COMP%]{position:relative;width:100%;padding-top:100%;overflow:hidden;background:var(--bg-secondary)}.image-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover}.remove-image-btn[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;background:var(--error);color:#fff;border:none;border-radius:50%;width:32px;height:32px;cursor:pointer;font-size:1.5rem;line-height:1;display:flex;align-items:center;justify-content:center;transition:transform .2s ease;box-shadow:0 2px 8px #0003;&:hover{transform:scale(1.1)}}.image-name[_ngcontent-%COMP%]{padding:.75rem;margin:0;font-size:.85rem;color:var(--text-primary);font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.image-size[_ngcontent-%COMP%]{padding:0 .75rem .75rem;margin:0;font-size:.75rem;color:var(--text-muted)}.existing-images-section[_ngcontent-%COMP%]{margin-top:2rem;padding-top:2rem;border-top:1px solid var(--neutral-medium);h3{font-size:1.2rem;margin-bottom:1rem;color:var(--text-primary)}}.existing-images-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:1.5rem}.existing-image-card[_ngcontent-%COMP%]{border:1px solid var(--neutral-medium);border-radius:var(--border-radius-small);overflow:hidden;background:#fff;position:relative;padding-top:100%;img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover}}.delete-image-btn[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;background:#f44336f2;color:#fff;border:none;padding:.5rem;cursor:pointer;font-size:.85rem;font-weight:500;transition:background .2s ease;&:hover{background:var(--error)}}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;margin-top:3rem;padding-top:2rem;border-top:1px solid var(--neutral-medium);.btn{min-width:150px}}@media (max-width: 768px){.product-form[_ngcontent-%COMP%]{padding:1.5rem}.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.selected-images-grid[_ngcontent-%COMP%], .existing-images-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:1rem}}"]})}}return a})()}}]);